var matrix=matrix||{};(function(mt){mt.Matrix=function(a,b,c,d){this.a=a;this.b=b;this.c=c;this.d=d};mt.IdentityMatrix=function(){return new mt.Matrix(1,0,0,1)};mt.NullMatrix=function(){return new mt.Matrix(0,0,0,0)};mt.Matrix.prototype.getDeterminant=function(){return this.a*this.d-this.b*this.c};mt.Matrix.prototype.getInverse=function(){var det=this.getDeterminant();if(det===0){return{exists:false}}return{exists:true,matrix:new mt.Matrix(this.d/det,-this.b/det,-this.c/det,this.a/det)}};mt.Matrix.prototype.add=function(m){return new mt.Matrix(this.a+m.a,this.b+m.b,this.c+m.c,this.d+m.d)};mt.Matrix.prototype.multiplyScalar=function(scalar){return new mt.Matrix(scalar*this.a,scalar*this.b,scalar*this.c,scalar*this.d)};mt.Matrix.prototype.multiplyRight=function(m){return new mt.Matrix(this.a*m.a+this.b*m.c,this.a*m.b+this.b*m.d,this.c*m.a+this.d*m.c,this.c*m.b+this.d*m.d)};mt.Matrix.prototype.multiplyLeft=function(m){return m.multiplyRight(this)};mt.Matrix.prototype.toString=function(){return"[["+this.a+", "+this.b+"], ["+this.c+", "+this.d+"]]"};mt.Matrix.prototype.equals=function(m){return Math.abs(this.a-m.a)<1e-9&&Math.abs(this.b-m.b)<1e-9&&Math.abs(this.c-m.c)<1e-9&&Math.abs(this.d-m.d)<1e-9};mt.Point=function(x,y){this.x=x;this.y=y};mt.Point.prototype.applyMatrix=function(m){return new mt.Point(this.x*m.a+this.y*m.b,this.x*m.c+this.y*m.d)};mt.Point.prototype.toString=function(){return"["+this.a+", "+this.b+"]"};mt.Grid=function(rect,options){this.rect=rect;this.numTicks=options.numTicks;this.tickSpacing=options.tickSpacing;this.tickLength=options.tickLength;this.gridlines=options.gridlines;this.center={x:this.rect.width/2+this.rect.x,y:this.rect.height/2+this.rect.y};if(this.numTicks===undefined){this.numTicks=10}if(this.tickSpacing===undefined){this.tickSpacing={x:rect.width/this.numTicks,y:rect.height/this.numTicks}}if(this.tickLength===undefined){this.tickLength=10}if(this.gridlines===undefined){this.gridlines=true}};mt.Grid.prototype.draw=function(two){var gridX;var gridY;var gridlineColor="#ddd";for(var x=0;x<=this.rect.width/this.tickSpacing.x;x++){if(this.gridlines){gridX=two.makeLine(x*this.tickSpacing.x+this.rect.x,this.rect.y,x*this.tickSpacing.x+this.rect.x,this.rect.height+this.rect.y);gridX.linewidth=1;gridX.stroke=gridlineColor}two.makeLine(x*this.tickSpacing.x+this.rect.x,this.center.y-this.tickLength/2,x*this.tickSpacing.x+this.rect.x,this.center.y+this.tickLength/2)}for(var y=0;y<=this.rect.height/this.tickSpacing.y;y++){if(this.gridlines){gridY=two.makeLine(this.rect.x,y*this.tickSpacing.y+this.rect.y,this.rect.height+this.rect.x,y*this.tickSpacing.y+this.rect.y);gridY.linewidth=1;gridY.stroke=gridlineColor}two.makeLine(this.center.x-this.tickLength/2,y*this.tickSpacing.y+this.rect.y,this.center.x+this.tickLength/2,y*this.tickSpacing.y+this.rect.y)}two.makeLine(this.center.x,this.rect.y,this.center.x,this.rect.height+this.rect.y);two.makeLine(this.rect.x,this.center.y,this.rect.width+this.rect.x,this.center.y)};mt.Grid.prototype.gridToScreenCoords=function(point){return new mt.Point(point.x*this.tickSpacing.x+this.center.x,-point.y*this.tickSpacing.y+this.center.y)};mt.Grid.prototype.scalePoints=function(arrayOfPoints){var scaled=[];for(var i=0;i<arrayOfPoints.length;i++){scaled.push(this.gridToScreenCoords(arrayOfPoints[i]))}return scaled};mt.drawPath=function(two,vertices,fillColor,strokeColor){var v=[];for(var i=0;i<vertices.length;++i){v.push(vertices[i].x);v.push(vertices[i].y)}v.push(false);var path=two.makePath.apply(two,v);path.fill=fillColor;path.stroke=strokeColor;path.linewidth=2;path.opacity=.5};mt.runApp=function(canvasElem){var two=new Two({width:600,height:600}).appendTo(canvasElem);var pad=10;var rect={x:pad,y:pad,width:two.width-pad*2,height:two.height-pad*2};var numTicks=10;var grid=new mt.Grid(rect,{numTicks:numTicks});var matrix;var inverseMatrix;var lastTestedInverseMatrix;var originalMatrix;var currentShape="Triangle";var playing=false;function updateDisplay(){var transformedVertices;var scaledVertices;var vertices;two.clear();grid.draw(two);if(currentShape==="Triangle"){vertices=[new mt.Point(0,0),new mt.Point(1,0),new mt.Point(1,1)]}else if(currentShape==="Square"){vertices=[new mt.Point(0,0),new mt.Point(1,0),new mt.Point(1,1),new mt.Point(0,1)]}scaledVertices=grid.scalePoints(vertices);mt.drawPath(two,scaledVertices,"#FF9E96","#F45346");transformedVertices=[];for(var i=0;i<vertices.length;i++){transformedVertices.push(vertices[i].applyMatrix(matrix))}scaledVertices=grid.scalePoints(transformedVertices);mt.drawPath(two,scaledVertices,"#DAF791","#A1D916");two.update()}jQuery("#shapeSelect").change(function(){currentShape=jQuery("#shapeSelect option:selected").text();updateDisplay()});jQuery("#test").click(function(){matrix=originalMatrix;var toTest=new mt.Matrix(Number(jQuery("#matrixElemA").val()),Number(jQuery("#matrixElemB").val()),Number(jQuery("#matrixElemC").val()),Number(jQuery("#matrixElemD").val()));lastTestedInverseMatrix=toTest;if(toTest.equals(inverseMatrix)===true){correct=true}else{correct=false}if(playing===false){animate(true,animate.bind(this,false))}});function animate(forward,finishCallback){var numSteps=50;var currentMatrix=mt.IdentityMatrix();var transformedVertices=[];var scaledVertices;var vertices;var inv;playing=true;if(forward===true){inv=originalMatrix}else{inv=lastTestedInverseMatrix}if(currentShape==="Triangle"){vertices=[new mt.Point(0,0),new mt.Point(1,0),new mt.Point(1,1)]}else if(currentShape==="Square"){vertices=[new mt.Point(0,0),new mt.Point(1,0),new mt.Point(1,1),new mt.Point(0,1)]}var E=(inv.a+inv.d)/2;var F=(inv.a-inv.d)/2;var G=(inv.c+inv.b)/2;var H=(inv.c-inv.b)/2;var Q=Math.sqrt(Math.pow(E,2)+Math.pow(H,2));var R=Math.sqrt(Math.pow(F,2)+Math.pow(G,2));var sx=Q+R;var sy=Q-R;var a1=Math.atan2(G,F);var a2=Math.atan2(H,E);var theta=-(a2-a1)/2;var phi=-(a2+a1)/2;var firstRotation=new mt.Matrix(Math.cos(theta),Math.sin(theta),-Math.sin(theta),Math.cos(theta));var scale=new mt.Matrix(sx,0,0,sy);var secondRotation=new mt.Matrix(Math.cos(phi),Math.sin(phi),-Math.sin(phi),Math.cos(phi));var stage=0;var angle=0;var currScaleX=1;var currScaleY=1;(function update(){if(stage===0){angle+=theta/numSteps;currentMatrix=new mt.Matrix(Math.cos(angle),Math.sin(angle),-Math.sin(angle),Math.cos(angle))}else if(stage===1){currScaleX+=(sx-1)/numSteps;currScaleY+=(sy-1)/numSteps;currentMatrix=new mt.Matrix(currScaleX,0,0,currScaleY).multiplyRight(firstRotation)}else if(stage===2){angle+=phi/numSteps;currentMatrix=new mt.Matrix(Math.cos(angle),Math.sin(angle),-Math.sin(angle),Math.cos(angle)).multiplyRight(scale).multiplyRight(firstRotation)}two.clear();grid.draw(two);scaledVertices=grid.scalePoints(vertices);mt.drawPath(two,scaledVertices,"#FF9E96","#F45346");for(var i=0;i<vertices.length;i++){if(forward===true){transformedVertices.push(vertices[i].applyMatrix(currentMatrix))}else{transformedVertices.push(vertices[i].applyMatrix(originalMatrix).applyMatrix(currentMatrix))}}scaledVertices=grid.scalePoints(transformedVertices);mt.drawPath(two,scaledVertices,"#DAF791","#A1D916");scaledVertices=[];transformedVertices=[];two.update();if(stage===0&&currentMatrix.equals(firstRotation)){stage++;currentMatrix=mt.IdentityMatrix()}else if(stage===1&&currentMatrix.equals(scale.multiplyRight(firstRotation))){stage++;currentMatrix=mt.IdentityMatrix();angle=0}else if(stage===2&&currentMatrix.equals(secondRotation.multiplyRight(scale.multiplyRight(firstRotation)))){if(finishCallback!==undefined){setTimeout(finishCallback,1e3)}else{playing=false}return}requestAnimationFrame(update)})()}jQuery("#debugInverse").click(function(){jQuery("#matrixElemA").val(inverseMatrix.a);jQuery("#matrixElemB").val(inverseMatrix.b);jQuery("#matrixElemC").val(inverseMatrix.c);jQuery("#matrixElemD").val(inverseMatrix.d);updateResultingMatrix()});function updateResultingMatrix(){var res;var toTest=new mt.Matrix(Number(jQuery("#matrixElemA").val()),Number(jQuery("#matrixElemB").val()),Number(jQuery("#matrixElemC").val()),Number(jQuery("#matrixElemD").val()));if(isNaN(toTest.a)||isNaN(toTest.b)||isNaN(toTest.c)||isNaN(toTest.d)){return}res=originalMatrix.multiplyRight(toTest);res.a=Math.round(res.a*100)/100;res.b=Math.round(res.b*100)/100;res.c=Math.round(res.c*100)/100;res.d=Math.round(res.d*100)/100;jQuery("#resultingMatrix").text("\\(= \\begin{pmatrix} "+res.a+" & "+res.b+" \\\\ "+res.c+" & "+res.d+" \\end{pmatrix} \\)");MathJax.Hub.Queue(["Typeset",MathJax.Hub,"MatrixTransformations"])}jQuery("#matrixElemA").on("input",updateResultingMatrix);jQuery("#matrixElemB").on("input",updateResultingMatrix);jQuery("#matrixElemC").on("input",updateResultingMatrix);jQuery("#matrixElemD").on("input",updateResultingMatrix);jQuery(function(){function getRandomInt(min,max){return Math.floor(Math.random()*(max-min))+min}matrix=new mt.Matrix(getRandomInt(-4,4),getRandomInt(-4,4),getRandomInt(-4,4),getRandomInt(-4,4));while(matrix.getDeterminant()===0){matrix=new mt.Matrix(getRandomInt(-4,4),getRandomInt(-4,4),getRandomInt(-4,4),getRandomInt(-4,4))}originalMatrix=matrix;jQuery("#toFindInverseOf").append("\\(\\begin{pmatrix} "+matrix.a+"&"+matrix.b+"\\\\"+matrix.c+"&"+matrix.d+"\\end{pmatrix}\\)");inverseMatrix=matrix.getInverse().matrix;lastTestedInverseMatrix=mt.NullMatrix();inverseMatrix=new mt.Matrix(inverseMatrix.a.toPrecision(3),inverseMatrix.b.toPrecision(3),inverseMatrix.c.toPrecision(3),inverseMatrix.d.toPrecision(3));jQuery("#resultingMatrix").text("\\(= \\begin{pmatrix} 0 & 0 \\\\ 0 & 0 \\end{pmatrix} \\)");MathJax.Hub.Queue(["Typeset",MathJax.Hub,"MatrixTransformations"]);updateDisplay();two.update()})}})(matrix);MathJax.Hub.Queue(function(){jQuery("#hidePage").css("visibility","");var elem=jQuery("#canvasContainer")[0];matrix.runApp(elem)});
